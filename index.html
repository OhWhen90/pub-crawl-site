<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <title>Pub Crawl Challenge List</title>
  <style>
    body {
      font-family: sans-serif;
      font-size: 18px;
      max-width: 600px;
      margin: 0 auto;
      padding: 1rem;
      background: #f9f9f9;
      color: #222;
    }
    h1, h2 {
      text-align: center;
    }
    label {
      display: flex;
      align-items: flex-start;
      padding: 0.6rem 0;
      font-size: 1.2rem;
      cursor: pointer;
    }
    input[type="checkbox"] {
      margin-right: 1rem;
      transform: scale(1.3);
    }
    .emoji {
      margin-right: 0.3rem;
      font-size: 1.4rem;
    }
    .challenge-title {
      font-weight: bold;
    }
    .challenge-desc {
      margin-left: 2.7rem;
      font-size: 1rem;
      color: #555;
      margin-top: -0.3rem;
    }
    .bonus, .rainbow {
      margin-left: 2.7rem;
      font-size: 0.95rem;
      color: #444;
    }
    .rainbow input[type="checkbox"],
    .bonus input[type="checkbox"] {
      transform: scale(1.1);
      margin-right: 0.4rem;
    }
    .rainbow label {
      display: block;
      width: 100%;
      margin-top: 0.3rem;
    }
    #reset-btn {
      margin: 2rem auto 1rem;
      display: block;
      font-size: 1.3rem;
      background: #e74c3c;
      color: white;
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s ease;
    }
    #reset-btn:hover {
      background: #c0392b;
    }

    /* Style for the secret challenges container */
    #secret-challenge-section {
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.7s ease-in-out, max-height 0.7s ease-in-out;
      pointer-events: none; /* Prevents interaction when hidden */
      margin-top: 2rem;
      border-top: 2px dashed #ccc;
      padding-top: 1rem;
    }
    #secret-challenge-section.revealed {
      opacity: 1;
      max-height: 500px; /* Adjust as needed to fit all secret challenges */
      pointer-events: auto;
    }
    #secret-challenge-section h2 {
        color: #5a2a8b; /* A distinct color for secret section heading */
    }
  </style>
</head>
<body>

<h1 id="main-heading">Pub Crawl Challenge List</h1>

<div id="challenge-container"></div>

<div id="secret-challenge-section">
    <h2 style="text-align: center;">ü§´ Secret Challenges! ü§´</h2>
    <div id="secret-challenge-container"></div>
</div>

<div style="text-align: center; margin-top: 2rem; font-size: 1.2rem;">
  <div id="main-count">‚úîÔ∏è Challenges Completed: 0 / 10</div>
  <div id="bonus-count">‚≠ê Bonus Points Earned: 0</div>
  <div id="total-score">üèÜ Total Score: 0 / 10</div>
</div>

<button id="reset-btn">Reset Progress</button>

<script>
  const STORAGE_KEY = "pubCrawlChallengeProgress";
  const SECRET_SECTION_KEY = "pubCrawlSecretSectionRevealed"; // Key for entire secret section

  const challenges = [
    { id: 0, emojis: ["üîÅ", "üëï"], title: "Closet Shuffle.", desc: "Swap an item of clothing with someone for the entire time at one location." },
    { id: 1, emojis: ["üåà", "üçπ"], title: "Taste the Rainbow.", desc: "Drink two different colours of the rainbow ‚Äî use cocktails, shots, or even mixers.", rainbow: true },
    { id: 2, emojis: ["ü•§", "üç∏"], title: "The Diana Special.", desc: "Finish your entire drink using three (or more) straws at once." },
    { id: 3, emojis: ["üîô", "üö∂‚Äç‚ôÇÔ∏è"], title: "Backwards Journey.", desc: "Walk backwards between any two crawl stops. Safety first, though ‚Äî have a guide!" },
    { id: 4, emojis: ["üß¶", "‚úã"], title: "Sock Puppet Hour.", desc: "Wear a sock on your right hand for the entire time at one location. Introduce it as your new drinking buddy." },
    { id: 5, emojis: ["üï∫", "üíÉ"], title: "Dance-Off Destiny.", desc: "Join or start a dance-off.", bonus: "If you win or get strangers to cheer." },
    { id: 6, emojis: ["ü§´", "üìé"], title: "The Sneaky Peg.", desc: "Clip your peg on someone without them noticing ‚Äî it must stay there for 15 minutes. Proof required!", bonus: "Someone leaves a crawl stop wearing your peg.", bonusAlwaysEnabled: true },
    { id: 7, emojis: ["üé≠", "üó£Ô∏è"], title: "Accent Order (Encore).", desc: "Order your drink in a full accent (e.g. French, pirate, cowboy, Scottish).", bonus: "Stay in character until you have finished your drink." },
    { id: 8, emojis: ["üì∏", "ü§≥"], title: "The Hospitality Selfie.", desc: "Take a selfie with either a bartender or a bouncer.", bonus: "If they smile." },
    { id: 9, emojis: ["üçª", "ü•Ç"], title: "The Icebreaker Toast.", desc: "Walk up to a complete stranger (or another group) and confidently give a short but passionate toast in their honour.", bonus: "They toast back." }
  ];

  // Completely separate list of secret challenges
  const secretChallenges = [
    { id: 10, emojis: ["üí∞", "üçπ"], title: "The Generosity Gambit: Round One.", desc: "Buy Owen a drink. It's for science, and good karma (mostly science)."},
    { id: 11, emojis: ["üí∏", "üç∏"], title: "The Double Down Delight: Round Two.", desc: "Buy Owen *another* drink. Clearly, his thirst is legendary. Or he's just really good at this game."},
    { id: 12, emojis: ["ü§ë", "ü•Ç"], title: "The Triple Treat Triumph: Round Three.", desc: "Buy Owen a *third* drink. At this point, it's less a challenge, more an investment in his happiness. And your score."}
  ];

  const rainbowColors = ["red", "orange", "yellow", "green", "blue", "indigo", "violet"];

  // Combine all challenges for easy iteration in save/load/updateScore
  const allChallenges = [...challenges, ...secretChallenges];

  // Save current checkbox states to localStorage
  function saveProgress() {
    const state = {};
    allChallenges.forEach(ch => { // Iterate over allChallenges
      const mainCheckbox = document.getElementById(`chk${ch.id}`);
      if (mainCheckbox) state[`chk${ch.id}`] = mainCheckbox.checked;
      const bonusCheckbox = document.getElementById(`chk${ch.id}b`);
      if (bonusCheckbox) state[`chk${ch.id}b`] = bonusCheckbox.checked;
    });
    rainbowColors.forEach(color => {
      const cb = document.getElementById(`rainbow-${color}`);
      if (cb) state[`rainbow-${color}`] = cb.checked;
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  // Save secret section revealed status
  function saveSecretSectionRevealedStatus(isRevealed) {
    localStorage.setItem(SECRET_SECTION_KEY, JSON.stringify(isRevealed));
  }

  // Load checkbox states and secret section revealed status from localStorage
  function loadProgress() {
    const stateStr = localStorage.getItem(STORAGE_KEY);
    if (!stateStr) return;
    const state = JSON.parse(stateStr);
    Object.entries(state).forEach(([key, val]) => {
      const el = document.getElementById(key);
      if (el) el.checked = val;
    });

    // Load secret section revealed status
    const isSecretSectionRevealed = JSON.parse(localStorage.getItem(SECRET_SECTION_KEY) || "false");
    const secretSection = document.getElementById("secret-challenge-section");
    if (secretSection && isSecretSectionRevealed) {
      secretSection.classList.add("revealed");
    }
  }

  // Function to create challenge elements (reusable for both normal and secret lists)
  function createChallengeElement(ch) {
    const label = document.createElement("label");
    label.id = `challenge-item-${ch.id}`; // Add an ID for easy targeting

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.id = `chk${ch.id}`;
    if (ch.id === 1) checkbox.disabled = true; // Rainbow main checkbox disabled for manual ticking
    label.appendChild(checkbox);

    ch.emojis.forEach(e => {
      const span = document.createElement("span");
      span.className = "emoji";
      span.textContent = e;
      label.appendChild(span);
    });

    const div = document.createElement("div");
    const titleSpan = document.createElement("span");
    titleSpan.className = "challenge-title";
    titleSpan.textContent = ch.title;
    div.appendChild(titleSpan);

    const descDiv = document.createElement("div");
    descDiv.className = "challenge-desc";
    descDiv.textContent = ch.desc;
    div.appendChild(descDiv);

    if (ch.rainbow) {
      const colorContainer = document.createElement("div");
      colorContainer.className = "rainbow";
      const emojis = {
        red: "üî¥", orange: "üü†", yellow: "üü°", green: "üü¢",
        blue: "üîµ", indigo: "üü£", violet: "üü£"
      };
      rainbowColors.forEach(color => {
        const capitalized = color.charAt(0).toUpperCase() + color.slice(1);
        colorContainer.innerHTML += `<label><input type="checkbox" id="rainbow-${color}">${emojis[color]} ${capitalized}</label>`;
      });
      colorContainer.innerHTML += `<div class="bonus" style="margin-top:0.3rem;">‚≠ê Bonus: Each additional colour beyond two.</div>`;
      div.appendChild(colorContainer);
    }

    if (ch.bonus) {
      const bonusContainer = document.createElement("div");
      bonusContainer.className = "bonus";
      // Ensure data-always is preserved for Sneaky Peg
      bonusContainer.innerHTML = `<input type="checkbox" id="chk${ch.id}b" ${ch.bonusAlwaysEnabled ? 'data-always' : 'disabled'} />‚≠ê Bonus: ${ch.bonus}`;
      div.appendChild(bonusContainer);
    }

    label.appendChild(div);
    return label;
  }


  function createChallenges() {
    const mainContainer = document.getElementById("challenge-container");
    const secretContainer = document.getElementById("secret-challenge-container");
    mainContainer.innerHTML = "";  // Clear container before creating
    secretContainer.innerHTML = ""; // Clear secret container

    challenges.forEach(ch => {
      mainContainer.appendChild(createChallengeElement(ch));
    });

    secretChallenges.forEach(ch => {
      secretContainer.appendChild(createChallengeElement(ch));
    });
  }

  function updateScore() {
    let main = 0;
    let bonus = 0;
    let rainbowCount = 0;

    // Calculate rainbow challenge progress first
    rainbowColors.forEach(color => {
      const cb = document.getElementById("rainbow-" + color);
      if (cb && cb.checked) rainbowCount++;
    });

    const rainbowMain = document.getElementById("chk1");
    if (rainbowMain) { // Ensure element exists before accessing
      if (rainbowCount >= 2) {
        if (!rainbowMain.checked) rainbowMain.checked = true;
        if (rainbowCount > 2) bonus += rainbowCount - 2;
      } else {
        rainbowMain.checked = false;
      }
    }

    const isSecretSectionRevealed = document.getElementById("secret-challenge-section").classList.contains("revealed");

    allChallenges.forEach(ch => {
      const chk = document.getElementById("chk" + ch.id);
      const bchk = document.getElementById("chk" + ch.id + "b");

      let isSecret = secretChallenges.some(sCh => sCh.id === ch.id);

      // Only count if it's a regular challenge, OR if it's a secret challenge AND the secret section is revealed
      if (!isSecret || (isSecret && isSecretSectionRevealed)) {
          if (chk && chk.checked && ch.id !== 1) main++;
          if (ch.id === 1 && chk.checked) main++; // Ensure Rainbow main counts
          if (bchk && bchk.checked) bonus++;
      }
    });

    // Update main challenges count - only count original 10 challenges for this
    const completedMainChallenges = challenges.filter(ch => {
      const chk = document.getElementById("chk" + ch.id);
      return chk && chk.checked;
    }).length;

    // Calculate total possible main points (initial challenges + revealed secret challenges)
    let totalPossibleMain = challenges.length;
    if (isSecretSectionRevealed) {
        totalPossibleMain += secretChallenges.length;
    }
    // Calculate total possible bonus points (for initial challenges only, as Owen doesn't have bonus)
    let totalPossibleBonus = challenges.filter(ch => ch.bonus).length;
    // Add bonus points from rainbow challenge if applicable (max additional 4 if all rainbow colors are checked and 2 are base)
    totalPossibleBonus += 4; // Assuming 6 rainbow colors - 2 base = 4 bonus.

    document.getElementById("main-count").textContent = `‚úîÔ∏è Challenges Completed: ${completedMainChallenges} / ${challenges.length}`;
    document.getElementById("bonus-count").textContent = `‚≠ê Bonus Points Earned: ${bonus}`; // Bonus can go above 10 now, removing the / 10
    document.getElementById("total-score").textContent = `üèÜ Total Score: ${main + bonus} / ${totalPossibleMain + totalPossibleBonus}`;
  }

  function resetProgress() {
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(SECRET_SECTION_KEY); // Clear secret section revealed status

    // Uncheck everything manually and reset disabled states
    allChallenges.forEach(ch => { // Iterate over all challenges
      const chk = document.getElementById(`chk${ch.id}`);
      if (chk) chk.checked = false;
      const bchk = document.getElementById(`chk${ch.id}b`);
      if (bchk) {
        bchk.checked = false;
        if (!bchk.hasAttribute("data-always")) {
          bchk.disabled = true; // Disable them by default on reset
        }
      }
    });
    rainbowColors.forEach(color => {
      const cb = document.getElementById(`rainbow-${color}`);
      if (cb) cb.checked = false;
    });

    // Hide the secret challenge section again
    const secretSection = document.getElementById("secret-challenge-section");
    if (secretSection) {
      secretSection.classList.remove("revealed");
    }

    updateScore();
    saveProgress(); // Save the cleared state
  }

  document.addEventListener("DOMContentLoaded", () => {
    createChallenges();
    loadProgress();
    updateScore();

    // Event listener for the main heading double-click
    document.getElementById("main-heading").addEventListener("dblclick", () => {
      const secretSection = document.getElementById("secret-challenge-section");
      if (secretSection) {
        secretSection.classList.add("revealed");
        saveSecretSectionRevealedStatus(true);
        updateScore(); // Update score to reflect newly revealed challenges
      }
    });

    document.addEventListener("change", e => {
      const id = e.target.id;

      // Enable or disable bonus checkboxes
      if (id.startsWith("chk") && !id.endsWith("b")) {
        const bonusBox = document.getElementById(id + "b");
        if (bonusBox && !bonusBox.hasAttribute("data-always")) {
          bonusBox.disabled = !e.target.checked;
          if (!e.target.checked) bonusBox.checked = false;
        }
      }

      updateScore();
      saveProgress();
    });

    document.getElementById("reset-btn").addEventListener("click", () => {
      if (confirm("Are you sure you want to reset all progress? This will also re-hide the secret challenges.")) {
        resetProgress();
      }
    });
  });
</script>

</body>
</html>
